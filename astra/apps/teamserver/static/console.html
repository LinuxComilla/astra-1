<html>
    <head>
        <link rel="stylesheet" type="text/css" href="/static/console.css"></link>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="/static/client.js"></script>
        <script>
            jQuery(document).ready(function() {
                var input = jQuery('input[name=message]');
                var output = jQuery('div#console');
                var client = new AstraClient('ws://' + window.location.host + '/ws');
                client.onopen = function() {
                    var stdin = 'astra.clients.' + client.session_id + '.stdin';
                    var stdout = 'astra.clients.' + client.session_id + '.stdout';
                    var stderr = 'astra.clients.' + client.session_id + '.stderr';

                    client.onevent(stdout, function(data) {
                        var line = jQuery('<div>').addClass('stdout').text(data.kwargs.message);
                        output.append(line);
                    });

                    client.onevent(stderr, function(data) {
                        var line = jQuery('<div>').addClass('stderr').text(data.kwargs.message);
                        output.append(line);
                    });

                    jQuery('button#send').on('click', function() {
                        client.publish(stdin, {}, [input.val()]);
                    });

                    console.debug('Publishing to ' + stdin);
                };
            });
        </script>
    </head>
    <body>
        <div id="console"></div>
        <input type="text" name="message" />
        <button id="send">Send</button>
    </body>
</html>
